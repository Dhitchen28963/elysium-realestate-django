{% extends 'base.html' %}

{% block title %}{{ property.title }}{% endblock %}

{% block banner %}
<!-- No banner for property detail page -->
{% endblock %}

{% block content %}
<main>
  <div class="property-detail">
    <div class="carousel-container">
      <div class="large-image">
        <img src="{{ property.property_images.first.image.url }}" alt="{{ property.title }}">
      </div>
      <div class="small-images">
        {% for image in property.property_images.all|slice:"1:3" %}
        <div class="small-image-item">
          <img src="{{ image.image.url }}" alt="{{ property.title }}">
        </div>
        {% endfor %}
      </div>
      <button class="carousel-control-prev">&lt;</button>
      <button class="carousel-control-next">&gt;</button>
    </div>

    <div class="thumbnail-container">
      {% for image in property.property_images.all %}
      <div class="thumbnail-item">
        <img src="{{ image.image.url }}" alt="{{ property.title }}">
      </div>
      {% endfor %}
    </div>

    <div class="property-detail">
      <div class="property-info">
        <h1>{{ property.title }}</h1>
        <p class="property-location">Location: {{ property.location }}</p>
        <p class="property-price">Price: Â£{{ property.price }}</p>
        <hr>
        <div class="property-features">
          <span class="feature-item">
            <i class="fa-solid fa-house"></i> Property Type: {{ property.get_property_type_display }}
          </span>
          <span class="feature-item">
            <i class="fa-solid fa-bed"></i> Bedrooms: {{ property.bedrooms }}
          </span>
          <span class="feature-item">
            <i class="fa-solid fa-bath"></i> Bathrooms: {{ property.bathrooms }}
          </span>
        </div>
        <hr>
        <div class="additional-features">
          <span class="feature-item">
            <i class="fa-solid fa-seedling"></i> Garden: {{ property.garden|yesno:"Yes,No" }}
          </span>
          <span class="feature-item">
            <i class="fa-solid fa-car"></i> Parking: {{ property.parking|yesno:"Yes,No" }}
          </span>
          <span class="feature-item">
            <i class="fa-solid fa-paw"></i> Pets Allowed: {{ property.pets_allowed|yesno:"Yes,No" }}
          </span>
        </div>
        <hr>
        <div>{{ property.description|safe }}</div>
      </div>
      <div class="property-actions">
        <button class="favorites-star" data-property-id="{{ property.id }}" data-is-favorite="{{ property.is_favorite }}" data-app="real_estate">
          {% if property.is_favorite %}
            <i class="fa-solid fa-star"></i> Saved
          {% else %}
            <i class="fa-regular fa-star"></i> Save
          {% endif %}
        </button>
        <button type="button" class="open-modal" data-property-id="{{ property.id }}" data-action="scheduleViewing">
          <i class="fa fa-calendar" aria-hidden="true"></i> Viewing
        </button>
      </div>
    </div>    
</main>

<!-- Modal for scheduling a viewing -->
<div id="viewingModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Request a Viewing</h2>
    <form id="custom-viewing-form" method="post" action="{% url 'request_custom_viewing' property.id %}" data-property-id="{{ property.id }}">
      {% csrf_token %}
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required>
      <label for="contact">Contact:</label>
      <input type="text" id="contact" name="contact" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      <label for="preferred_date">Preferred Date:</label>
      <input type="date" id="preferred_date" name="preferred_date" required>
      <label for="preferred_time">Preferred Time:</label>
      <input type="time" id="preferred_time" name="preferred_time" required>
      <label for="message">Message:</label>
      <textarea id="message" name="message" required></textarea>
      <button type="submit">Request Viewing</button>
    </form>
    <h3>Or select from available slots:</h3>
    <div id="available-slots-container"></div>

    <div id="slot-booking-form" style="display: none;">
      <label for="slot-name">Name:</label>
      <input type="text" id="slot-name" name="slot-name" required>
      <label for="slot-contact">Contact:</label>
      <input type="text" id="slot-contact" name="slot-contact" required>
      <label for="slot-email">Email:</label>
      <input type="email" id="slot-email" name="slot-email" required>
      <button type="button" id="book-slot-button">Book Slot</button>
    </div>
  </div>
</div>
    
{% endblock %}
