{% extends 'base.html' %}

{% block title %}{{ property.title }}{% endblock %}

{% block content %}
<main>
  <div class="property-details">
    {% if property.property_image %}
        <img src="{{ property.property_image.url }}" alt="{{ property.title }}">
    {% endif %}
    <div class="property-info">
      <h1>{{ property.title }}</h1>
      <div>{{ property.description|safe }}</div> <!-- Use safe filter for HTML content -->
      <p>Price: Â£{{ property.price }}</p>
      <p>Location: {{ property.location }}</p>
      <p>Bedrooms: {{ property.bedrooms }}</p>
      <p>Bathrooms: {{ property.bathrooms }}</p>
      <p>Furnished: {{ property.get_furnished_type_display }}</p>
      <p>Garden: {{ property.garden|yesno:"Yes,No" }}</p>
      <p>Parking: {{ property.parking|yesno:"Yes,No" }}</p>
      <p>Pets Allowed: {{ property.pets_allowed|yesno:"Yes,No" }}</p>
    </div>
    <div class="property-actions">
      <!-- Favorites Star Button -->
      <button class="favorites-star" data-property-id="{{ property.id }}" data-is-favorite="{{ property.is_favorite }}" data-app="real_estate">
        {% if property.is_favorite %}
          <i class="fa-solid fa-star"></i> Remove from Favorites
        {% else %}
          <i class="fa-regular fa-star"></i> Add to Favorites
        {% endif %}
      </button>
      <button type="button" class="open-modal" data-property-id="1" data-action="scheduleViewing">
        <i class="fa fa-calendar" aria-hidden="true"></i> Schedule a Viewing
      </button>
    </div>
    <div class="property-images">
      {% for image in additional_images %}
      <div class="image-wrapper">
        {% if image.image %}
            <img src="{{ image.image.url }}" alt="Additional image of {{ property.title }}">
        {% endif %}
      </div>
      {% endfor %}
    </div>
    <div class="property-enquiry">
      <h2>Contact about this property</h2>
      <form id="contact-form" method="post" action="{% url 'contact_property' property.id %}" data-property-id="{{ property.id }}">
        {% csrf_token %}
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <label for="message">Message:</label>
        <textarea id="message" name="message" required></textarea>
        <button type="submit">Send Message</button>
      </form>
    </div>
  </div>
</main>

<!-- Modal for scheduling a viewing -->
<div id="viewingModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Schedule a Viewing</h2>
    <form id="custom-viewing-form" method="post" action="{% url 'request_custom_viewing' property.id %}" data-property-id="{{ property.id }}">
      {% csrf_token %}
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required>
      <label for="contact">Contact:</label>
      <input type="text" id="contact" name="contact" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      <label for="preferred_date">Preferred Date:</label>
      <input type="date" id="preferred_date" name="preferred_date" required>
      <label for="preferred_time">Preferred Time:</label>
      <input type="time" id="preferred_time" name="preferred_time" required>
      <label for="message">Message:</label>
      <textarea id="message" name="message" required></textarea>
      <button type="submit">Request Viewing</button>
    </form>
  </div>
</div>
{% endblock %}